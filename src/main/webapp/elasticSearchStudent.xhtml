<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:b="http://bootsfaces.net/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://xmlns.jcp.org/jsf/passthrough">
    <h:head>
        <title>Elasticsearch - student</title>

        <link rel="shortcut icon" type="image/x-icon" href="#{resource['images/favicon.ico']}"/>
        <h:outputStylesheet library="css" name="bootstrap.min.css"/>
        <h:outputStylesheet library="css" name="bootstrap-theme.css" />

    </h:head>
    <h:body>

        <h:form>
            <b:growl id="growl3" 
                     global-only="true" 
                     show-detail="true" 
                     severity="info" 
                     allow-dismiss="true"
                     animation-enter="animated bounceInDown"
                     animation-exit="animated flipOutX"/>

            <b:growl id="growl4" 
                     global-only="true" 
                     show-detail="true" 
                     severity="warn" 
                     allow-dismiss="true"
                     animation-enter="animated bounceInDown"
                     animation-exit="animated flipOutX"/>
            <b:growl id="growl6" 
                     global-only="true" 
                     show-detail="true" 
                     severity="error" 
                     allow-dismiss="true"
                     animation-enter="animated bounceInDown"
                     animation-exit="animated flipOutX"/>
        </h:form>

        <b:navBar class="navbar navbar-inverse navbar-fixed-top" fluid="true" brand="filip-nst2">
            <div class="container">
                <div class="navbar-header">
                    <h:form>
                        <b:navbarLinks>
                            <b:navLink value="Homepage" href="homepage.xhtml"></b:navLink>
                            <b:dropMenu value="Student CRUD" icon-awesome="fa-graduation-cap">
                                <b:navLink value="Dodaj novog studenta" href="addstudent.xhtml"></b:navLink>
                                <b:navLink value="Prikazi sve studente" href="allstudents.xhtml"></b:navLink>
                            </b:dropMenu>
                            <b:dropMenu value="Ispit CRUD" icon-awesome="fa-stack-overflow">
                                <b:navLink value="Dodaj novi ispit" href="addispit.xhtml"></b:navLink>
                                <b:navLink value="Prikazi sve ispite" href="allispit.xhtml"></b:navLink>
                            </b:dropMenu>
                            <b:navLink value="Unesi polaganje" href="addpolaganje.xhtml" icon-awesome="fa-university"></b:navLink>
                            <b:dropMenu value="Elasticsearch" icon-awesome="fa-search">
                                <b:navLink value="ES Student" href="elasticSearchStudent.xhtml"></b:navLink>
                                <b:navLink value="ES Polaganja" href="elasticSearchPolaganje.xhtml"></b:navLink>
                            </b:dropMenu>
                            <b:navLink value="Logout" action="#{mbLogin.logout()}" href="index.xhtml" icon-awesome="fa-sign-out" ></b:navLink>
                        </b:navbarLinks>   
                    </h:form>
                </div>
            </div>
        </b:navBar>

        <br></br>
        <br></br>
        <br></br>
        <div align="left">
            <h:form>
                <f:metadata>
                    <f:event type="preRenderView" listener="#{mbElasticsearch.loadMesta()}"/>
                </f:metadata>
                <f:metadata>
                    <f:event type="preRenderView" listener="#{mbElasticsearch.loadAll()}"/>
                </f:metadata>
                <b:panel collapsible="false" title="Elasticsearch - STUDENT" style="width: 400px; float: left;">
                    <h:panelGrid columnClasses="alignmentLeft" >
                        <h:outputLabel value="Broj indeksa: *" for="brojIndeksa"/>
                        <b:inputText span="12" 
                                     value="#{mbElasticsearch.student.brInd}" 
                                     required="true" 
                                     requiredMessage="Unesite broj indeksa"
                                     validatorMessage="Broj indeksa nije u odgovarajucem formatu">
                            <f:validateRegex pattern="[1-9][0-9][0-9][0-9][/][0-9][0-9][0-9][0-9]"/>
                        </b:inputText>
                        <h:message for="brojIndeksa" style="color: red"/>

                        <h:outputLabel value="Ime: *" for="ime"/>
                        <b:inputText span="12" 
                                     value="#{mbElasticsearch.student.ime}" 
                                     required="true" 
                                     requiredMessage="Unesite ime"
                                     validatorMessage="Min 1 max 30 karaktera">
                            <f:validateLength minimum="1" maximum="30"/>
                        </b:inputText>
                        <h:message for="ime" style="color: red"/>

                        <h:outputLabel value="Prezime: *" for="prezime"/>
                        <b:inputText span="12" 
                                     value="#{mbElasticsearch.student.prezime}" 
                                     required="true" 
                                     requiredMessage="Unesite prezime"
                                     validatorMessage="Min 1 max 30 karaktera">
                            <f:validateLength minimum="1" maximum="30"/>
                        </b:inputText>
                        <h:message for="prezime" style="color: red"/>

                        <h:outputLabel value="Mesto: " styleClass="panel-body" for="mesto"/>
                        <b:selectOneMenu value="#{mbElasticsearch.student.mesto}" colMd="12" required="true" labelColMd="2">
                            <f:selectItems value="#{mbElasticsearch.listMesto}" 
                                           var="m"
                                           itemLabel="#{m.naziv}"
                                           itemValue="#{m}"/>
                        </b:selectOneMenu>
                        <h:message for="mesto" style="color: red"/>
                    </h:panelGrid>
                    <b:commandButton value="Sacuvaj" action="#{mbElasticsearch.persistStudent()}" look="primary" />
                    <b:commandButton value="Obrisi studenta" action="#{mbElasticsearch.deleteStudent()}" look="primary" disabled="#{mbElasticsearch.selectedStudent == null}"/>
                </b:panel>
            </h:form>
        </div>

        <b:panel collapsible="false" title="Elasticsearch - STUDENT" style="width: 1300px; float: left">
            <div class="panel-body">
                <h:form id="j_idt237">
                    <div id="qwerty1" class="dataTables_wrapper form-inline dt-bootstrap no-footer">
                        <div class="row">
                            <div class="col-sm-6">
                                <div class="dataTables_length" id="qwerty2">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-sm-12">
                                <h:form>
                                    <f:metadata>
                                        <f:event type="preRenderView" listener="#{mbElasticsearch.findAllStudent()}"/>
                                    </f:metadata>
                                    <h:inputText id="wildCard" value="#{mbElasticsearch.wildCardQuery}" styleClass="panel-body">
                                        <f:passThroughAttribute name="placeholder" value="Pretrazi..." />
                                        <f:ajax event="keyup" execute="wildCard" listener="#{mbElasticsearch.fullTextSearch()}" render="studentTable" />
                                        <f:ajax event="blur" listener="#{mbElasticsearch.clearWildCardQuery()}" render="@this" />
                                    </h:inputText>
                                    <br></br>
                                    <br></br>
                                    <b:dataTable id="studentTable" 
                                                 value="#{mbElasticsearch.studentList}"
                                                 var="student"
                                                 class="table table-bordered table-striped table-hover dataTable no-footer" 
                                                 border="true" 
                                                 searching="true">
                                        <f:facet name="header">
                                            <tr role = "row">
                                                <th colspan="1" rowspan="2" class="sorting" style="width: 250px;">Student - broj indeksa</th>
                                                <th colspan="2" rowspan="1">Osnovne info o studentu</th>
                                                <th colspan="2" rowspan="1">Mesto info</th>
                                                <th colspan="2" rowspan="1">Dodatne akcije</th>
                                            </tr>
                                            <tr role="row">
                                                <th class="sorting" tabindex="0" rowspan="1" colspan="1" style="width: 125px;">Ime</th>
                                                <th class="sorting" tabindex="0" rowspan="1" colspan="1" style="width: 125px;">Prezime</th>
                                                <th class="sorting" tabindex="0" rowspan="1" colspan="1" style="width: 125px;">Ptt mesta</th>
                                                <th class="sorting" tabindex="0" rowspan="1" colspan="1" style="width: 125px;">Naziv mesta</th>
                                            </tr>
                                        </f:facet>
                                        <b:dataTableColumn value="#{student.brInd}" data-order="#{mbElasticsearch.student.brInd}"/>
                                        <b:dataTableColumn value="#{student.ime}" />
                                        <b:dataTableColumn value="#{student.prezime}" />
                                        <b:dataTableColumn value="#{student.mesto.ptt}" />
                                        <b:dataTableColumn value="#{student.mesto.naziv}" />
                                        <b:commandButton look="danger" 
                                                         action="#{mbElasticsearch.prepareDocumentList()}"
                                                         size="xs" 
                                                         icon-awesome="fa-folder"
                                                         value="Vrati sva dokumenta">
                                        </b:commandButton>
                                    </b:dataTable>
                                </h:form>
                            </div>
                        </div>
                    </div>
                </h:form>
            </div>
        </b:panel>
    </h:body>
</html>

